11. 
12. Основные режимы функционирования микропроцессорной системы: основная программа, подпрограмма, прерывания, ПДП. Обработка прерываний и исключений. Системы с циклическим опросом. Блок приоритетных прерываний

**Основные режимы функционирования микропроцессорной системы: основная программа, подпрограмма, прерывания, ПДП.**

**Микропроцессорная система может находиться в одном из следующих режимов работы:**

∙выполнение основной программы;

∙вызов подпрограмм;

∙обработка прерываний и исключений; ∙прямой доступ к памяти.

**_Выполнение основной программы._** В этом режиме микропроцессор последовательно загружает из памяти команды и выполняет их. Для загрузки следующей команды микропроцессор хранит указатель (адрес) на нее в специальном регистре — _программном счетчике_ (Program Counter — PC, или Instruction Pointer — IP).

Содержимое этого регистра увеличивается на единицу каждый раз после выборки из памяти очередного слова* основной программы. При выполнении команд ветвления (безусловный и условный переходы, циклы) в счетчик загружается новое значение из кода адресации операндов, в результате процессор переходит к выполнению другой части программы. При использовании механизмов относительной адресации регистр PC является базовым регистром, к которому прибавляется адресная часть команды.

Очередная команда, загруженная из памяти команд, поступает в регистр команд в устройстве управления. Затем она дешифруется, и вычисляются адреса операндов согласно. Далее устройство управления в соответствии с операндом команды генерирует последовательность управляющих сигналов.

**_Вызов подпрограмм._** Для эффективного использования памяти дублирующиеся участки программы выделяют в отдельные подпрограммы. Для обращения к таким подпрограммам в систему команд процессора вводятся специальные команды вызова подпрограмм и возвращений из них (обычно обозначаемые CALL и RET соответственно).

Команда CALL в коде адреса содержит указатель на первый байт подпрограммы (или смещение, если используется относительная адресация), который загружается в регистр PC, обеспечивая на следующем такте выборку первой команды из подпрограммы. Предварительно текущее значение программного счетчика сохраняется для последующего возврата в основную программу. При поступлении команды RET процессор восстанавливает предыдущее значение регистра PC и продолжает выполнение основной программы с команды, следующей за командой CALL.

**_Обработка прерываний и исключений._** При работе микропроцессорной системы появляются события (например ввод данных от ВУ, или сработавший системный таймер), которые требуют немедленной реакции на них, для чего необходимо прервать текущую выполняемую программу и запустить подпрограмму обработки возникшего события. Такие события называются _прерываниями_ (interrupt), или исключениями.

Механизм обработки прерываний похож на механизм перехода в подпрограмму. При появлении сигнала прерывания процессор должен сохранить текущее состояние (_контекст_):

∙ регистр PC для обеспечения возможности возврата к выполнению основной программы;

∙ регистры состояния процессора (флаги АЛУ и т. п.);

∙регистры общего назначения; ∙специальные регистры.

После этого процессор передает управление обработчику прерывания, который производит необходимые действия для обеспечения реакции системы на прерывание и возвращает управление основной программе. Затем процессор возвращает контекст основной программы и продолжает выполнение с точки останова.

**_Прямой доступ к памяти._** Для выполнения рутинных операций пересылки массивов данных между ОЗУ и каким-либо внешним устройством применяется специальный режим прямого доступа к памяти (ПДП). Для этого в современные процессоры встраивают отдельный контроллер ПДП, связанный общей шиной с ОЗУ и периферийными устройствами.

Когда процессору необходимо переслать некоторый объем данных, он программирует контроллер ПДП на выполнение этой задачи. Процесс программирования состоит в передаче контроллеру трех значений: адреса—источника данных, адреса—приемника данных и количества передаваемых слов. Затем контроллер сам начинает передачу данных, а процессор в это время может выполнять основную программу.

Контроллер ПДП может иметь внешние сигналы запросов от периферийных устройств. При появлении такого сигнала на входе контроллер начинает копировать данные по заложенной процессором заранее программе. После завершения копирования контроллер ПДП генерирует сигнал прерывания, сообщая процессору, что данные скопированы и с ними можно работать.

Применение режима ПДП позволяет избавить процессор от выполнения задач пересылки данных, которые могут быть весьма длительными, особенно при общении с медленными периферийными устройствами.

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)