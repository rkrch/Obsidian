16. Иерархия памяти: причины, зависимости, следствия. Статическое и динамическое ОЗУ. Организация систем памяти в микропроцессорных системах.

**1)С течением времени производительность процессора увеличивалась в разы быстрее чем производительность памяти, вследствие чего память отделилась от процессора и стала отдельным блоком. Из-за этого появилась иерархия памяти**

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)

**Память в компьютере состоит из нескольких уровней, которые условно разделены на две части: внутренняя и внешняя. К внутренняя нужна для функционирования системы, а внешняя для хранения больших данных, которые могут быть использованы процессором не так часто.**

**Зависимости:**

**1)Чем ближе часть памяти к процессору, тем меньше у неё ёмкость и тем она быстрее работает.**

**2)Чем ближе часть памяти к процессору, тем чаще тот к ней обращается.**

**3)Чем дальше от процессора, тем дешевле единица памяти. Т.е. гигабайт магнитной ленты стоит во много раз дешевле гигабайта кэш-памяти.**

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)

**Статическая память (SRAM) — это память, сделанная из транзисторов (см. рис. 3). Адрес ячейки подаётся на address decoder, с помощью которого определяется с какой ячейки считывать/записывать данные. На drivers подаются данные, которые будут использованы для записи. На выходе стоят усилители сигнала — Sense amplifiers. Обычно из статической памяти делается кэш-память.**

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg)

**Ячейка статической памяти состоит из двух инверторов, которые в свою очередь состоят из двух транзисторов**

**Динамическая память (DRAM) — это память, состоящая из конденсаторов (см. рис. 5). Обычно из статической памяти делается оперативная память.**

**Ячейка динамической памяти (красный прямоугольник) состоит из одного конденсатора и одного транзистора, являющегося ключом. Если конденсатор заряжен, то в ячейке хранится 1, если разряжен — 0.**

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)

**Организация памяти в МПсис**

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image012.gif)

**Обработка прерываний и исключений. Системы с циклическим опросом. Блок приоритетных прерываний.**

**ПРЕРЫВАНИЯ/ИСКЛЮЧЕНИЯ**

С компьютером постоянно происходят события, на которые он должен реагировать, запуская соответствующие подпрограммы. Например, при движении мышки нужно перерисовать ее курсор на новом месте или нужно среагировать на подключение флешки и т.п. Возможность запускать нужные подпрограммы в ответ на различные события, возникающие внутри или снаружи компьютера, существенно расширяют его возможности. События, требующие внимания процессора называются прерываниями (interrupt). Происходящие события формируют запрос на прерывание процессору.

Система прерывания – это совокупность программно-аппаратных средств, позволяющая процессору (при получении соответствующего запроса) на время прервать выполнение текущей программы, передать управление программе обслуживания поступившего запроса, по завершению которой и продолжить прерванную программу с того места, где она была остановлена.

Прерывания делятся на маски́руемые — которые при желании можно игнорировать, и немаски́руемые — которые игнорировать нельзя (например сбой генератора тактового синхроимпульса в микроконтроллерах семейства [PIC24FJ512GU410](https://ww1.microchip.com/downloads/aemDocuments/documents/MCU16/ProductDocuments/DataSheets/PIC24FJ512GU410-Family-Data-Sheet-DS30010203D.pdf)[стр. 130]). Прерывание похоже на незапланированный вызов функции, вследствие события в аппаратном обеспечении. Программа (функция), запускаемая в ответ на прерывание, называется обработчиком прерывания.

События могут быть не только аппаратными, но и программными – синхронными. Такие события называются исключениями (exception). Программа может столкнуться с состоянием ошибки, вызванным программным обеспечением, таким как неопределенная инструкция, неподдерживаемая данным процессором, в таком случаях говорят, что возникло исключение. К исключениям также относятся сброс, деление на ноль, переполнение и попытки считывания из несуществующей памяти.

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image014.jpg)

Под исключением будут подразумеваться нетипичные условия, произошедшие во время исполнения программы, связанные с инструкцией в текущем харте (hart, сокращение от hardware thread — аппаратном потоке).

Под прерыванием будут подразумеваться внешние асинхронные события, которые могут стать причиной непредвиденной передачи управления внутри текущего харта.

Под перехватом (вариант глагольного использования слова trap, которое обычно переводят как "ловушка") будет подразумеваться передача управления обработчику перехватов (trap handler), вызванная либо прерыванием, либо исключением.

Иными словами, прерываниями мы будем называть исключительно аппаратные (внешние, асинхронные) события, которые могут привести к перехвату (передаче управления обработчику). Под исключениями мы будем подразумевать исключительно программные (являющиеся следствием какой-то инструкции, синхронные) события, которые могут привести к перехвату.

Соответственно перехватом будет называться обобщение этих двух терминов.

         Прерывания   и   исключения   —   это   события   (причины).   Перехват   —   это          действие

(следствие).

**Системы с циклическим опросом. Блок приоритетных прерываний.**

Система прерывания должна сформировать сигнал общего запроса на прерывание и код номера запроса на прерывание, по которому можно определить, каким образом обрабатывать данное прерывание. Если в вычислительной системе находится несколько устройств, которым требуется работа с процессором, то можно организовать _системусциклическимопросом_. В такой системе все линии, по которым в процессор поступают запросы на прерывание, опрашиваются по очереди с помощью специальной аппаратуры:

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image016.jpg)

По сигналу reset выход триггера T и счетчик CT обнуляются, счетчик начинает считать. Кодовое слово с него поступает на дешифратор, на выходе которого присутствует только один активный уровень, соответствующий коду. Если данный активный уровень совпадает с запросом на прерывание, то на триггер поступает сигнал, который переключает его в единичное состояние. Счетчик перестает считать, и на его выходе формируется код, соответствующий номеру запроса на прерывание.

Программируемый блок приоритетных прерываний:

Программируемый блок приоритетных прерываний позволяет обеспечить ранжирование запросов на прерывание по их важности или уровню.

Ключевыми элементами ПБПП являются:

∙ цепочечная однотактная схема определения приоритетного запроса;

∙ шифратор номера приоритетного запроса и формирователь кода номера запроса на прерывание;

∙ цифровой компаратор CMP.

На выходе цепочечной схемы определения приоритетного запроса формируются запрос на прерывание INT 1 и номер приоритетного запроса, который попадает в шифратор. Шифратор формирует код номера запроса, принятого к обслуживанию. Порог прерывания задается командой выполняемой программы, устанавливающей в регистре порога прерывания код уровня прерывания. Если код номера запроса, поступившего на обслуживание, больше кода уровня прерывания, то формируется общий сигнал прерывания INT 2; если нет, то поступивший запрос откладывается до тех пор, пока не будет выполнена текущая программа.

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image018.jpg)