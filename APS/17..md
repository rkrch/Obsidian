23. Арбитр магистрали. Алгоритмы и схемы арбитража. Методы повышения эффективности шин.

GPT

|   |
|---|
|Арбитр магистрали - это устройство, которое управляет доступом к общей шине|
|между несколькими устройствами, такими как процессоры, память или|
|устройства ввода-вывода. Оно обеспечивает порядок доступа к шине, чтобы|
|избежать конфликтов и повысить эффективность использования шины.|
|Алгоритмы арбитража определяют правила, по которым арбитр принимает|
|решения о предоставлении доступа к шине. Схемы арбитража - это аппаратные|
|реализации этих алгоритмов.е|
|Методы повышения эффективности шин включают использование|
|многопоточности, когда несколько запросов на доступ к шине обрабатываются|
|одновременно, и использование приоритетов, когда некоторые запросы|
|получают более высокий приоритет, чем другие. Также используются|
|технологии, такие как упреждающая выборка данных, когда данные|
|считываются заранее, чтобы уменьшить время ожидания доступа к шине.|

Лекция

**Кто реализует арбитраж** – его реализует специальное устройство арбитр магистрали(или просто арбитр)

**Где сидит арбитр?**

Он подключен так же к шине, то есть это еще дополнительное устройство, которое находится на шине, то есть на той картинке, где постоянно были изображены шина, процессор, память, там нужно дорисовать дополнительное устройство, не всегда оно является отдельным устройством, оно часто находится внутри какого-то другого устройства, например в ЦП(то есть оно может быть реализовано как отдельное устройство в виде микросхемки, либо как дополнительный элемент рядом с ЦП или с контроллером)

Арбитраж шин, существуют различные алгоритмы арбитража( арбитраж – у нас есть несколько устройств, есть общая шина, есть несколько ведущих устройств и ведомых устройств, в один момент времени шиной может владеть только одно ведущее устройство, но никто не запрещает им хотеть владеть шиной одновременно, но нужно выбрать только одно устройство и как выбрать какое)

Существуют алгоритмы арбитража(выбор того самого одного устройства для этой общей шины):

v **Алгоритмы арбитража**

                               ·    Каждому потенциальному ведущему присваивается приоритет

Ø Статический приоритет (то есть подключили систему, 1, 2 приоритет и больше никогда они не меняются, с одной стороны это просто, с другой это может привести к ситуации, когда одной из устройств с высоким приоритетом постоянно хочет шину и другое устройство с более низким приоритетом тоже хочет эту шину, но оно будет вынуждено просто постоянно ждать)

Ø Динамический приоритет(после каждой транзакции на шине происходит переопределение приоритетов)

¨    Простая циклическая смена приоритетов(суть в том, что есть 1,2,3,4(4 устройства), у каждого есть свои приоритеты, если запрашивают шину 1 и 2 устройство, шину получит то, у которого выше приоритет, но после того как это устройство с более высоким приоритетом пообщалось, транзакция закончилась, арбитр магистрали после каждой транзакции приоритеты обновляет

¨    Циклическая смена приоритетов с учетом последнего запроса(более продвинутая). Буду объяснять по картинке, например устройство 3 захотело пообщаться и оно выиграло обмен на шине, после того как оно заканчивает, оно сообщает арбитру и он выставляет устройству 3 самый маленький приоритет, допустим после этого выиграло устройство 1, выиграло шину, закончило транзакцию и арбитр выставляет устройству 1 самый низкий приоритет и так далее

                                                                    ¨            Смена приоритетов по случайному закону(RND)

¨    Алгоритм наиболее давнего использования(LRU), кто дольше всего не использовался, тому выставляется больший приоритет

Ø Фиксированный квант времени(то есть устройство, которое последовательно спрашивает, кто хочет общаться, если устройство, к которому обратились хочет общаться, оно общается и потом мы просто переходим к следующему и спрашиваем уже у него хочет ли оно общаться, ходим по кругу и каждому выделяется квант времени, когда он может пообщаться, если он не хочет им пользоваться, то просто спрашивают следующего)

Ø На основе очереди (FIFO) – применяется специальная память, куда складываются в порядке очереди запросы от всех устройств и когда шина освобождается, то вновь занимает шину тот, кто 1 стоит в очереди, не самое эффективное решение, так как очередь может переполниться)

Простая циклическая смена приоритетов

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)

Циклическая смена приоритетов с учетом последнего запроса

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

(ПШ7, ПШ6… предоставление шины)

(ЗШ7, ЗШ6.. запрос шины)

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image007.jpg)

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image009.jpg)

**Сейчас мы и поговорим про центральный параллельный арбитр, который и реализует задачу арбитража**

У нас есть ведущие устройства, есть центральный арбитр, от этих ведущих устройств идет сигнал запроса шины(то есть когда они хотят запросить шину), а из центрального арбитра выходит сигнал предоставления шины(он сообщает устройству, что оно может пользоваться шиной), также есть сигнал ШЗ(шина занята) по которому центральный арбитр узнает, пользуется ли кто-то щас шиной **Как все работает?**

Допустим есть некоторое устройство, которое прямо сейчас занимает шину и сообщает о том, что шина занята, это устройство занимает шину, потому что центральное устройство в данный момент разрешает этому устройству это делать

  

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image011.jpg)

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image013.jpg)

  

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image015.jpg)

в этот же момент времени другому устройству тоже нужна эта шина и оно сообщает об этом центральному арбитру(запрос шины), центральный арбитр смотрит на приоритет и например у этого устройства приоритет выше, тогда он отцепляет сигнал ПШ от устройства ПШ6(это устройство заканчивает свои дела, оно же не может сразу закончить) и передает сигнал ПШ к устройству ПШ7 и теперь это устройство занимает шину(работает все хорошо, быстро и легко, единственное, если накрылся центральный арбитр, то накрылась вся система, так как много точек соединения)

**Сейчас мы и поговорим про центральный последовательный арбитр, который и реализует задачу арбитража**

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image017.jpg)

Идея в том, чтобы уменьшить количество линий, которые соединяют все устройства, заменить все ШЗ на общую линию ШЗ и объединить все линии ЗШ в одну общую ЗШ

Захотели несколько устройств получить доступ к шине, центральный арбитр смотрит, что шина не занята, если кто-то запрашивает, то он выдает сигнал ПШ, его видит первое ведущее устройство, но оно не запрашивало предоставление шины, поэтому оно передает сигнал дальше и уже напрмер 2 устройство выставляет сигнал ШЗ и пользуется им, следующее устройство должно подождать, пока предыдущее закончит свою работу. Плюсы: просто реализуемо, минусы: статическое распределение приоритетов.

**Сейчас мы и поговорим про децентрализованный арбитр, который и реализует задачу арбитража**

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image019.jpg)

Это когда арбитр есть внутри каждого ведущего устройства и они все следят за всеми, у каждого есть ЗШ, каждый блок в каждый момент времени видит, кто запрашивает информацию, по дополнительным линиям ему может сообщится какой у него приоритет(каждое ведущее устройство знает свой приоритет) и когда они выставляют ЗШ, если это делают сразу несколько устройств одновременно, то каждое устройство, зная свой приоритет, то после того как оно выставило ЗШ, оно с него снимет, если его приоритет меньше. Плюсы: если где-то арбитр вышел из строя или устройство, то ничего страшного не произойдет, система продолжит работать, но уже без этого устройства, то есть большая надежность. Минусы: нужно много проводов, нужно расположить внутри каждого устройства свой арбитр, аппаратные затраты

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image021.jpg)

**Как же повысить эффективность шин?**

1)  Пакетный режим пересылки информации

Выставляется адрес и пока этот адрес выставлен, выдаются данные по этому адресу

2)  Конвейеризация транзакций

То есть пока обрабатываются одни запросы , выставляются уже следующие

3)  Протокол с расщеплением транзакций

Контроллер шины – это устройство между устройством и шиной, устройство оно не сразу напрямую с шиной общается, а через контроллер шины(он обеспечивает правильную последовательность действий). В этот контроллере шины можно предусмотреть протокол с расщеплением транзакций, то есть идет обращение (адрес1, адрес2, адрес3, адрес4), а реакция на них может совершенно в другие моменты времени, то есть данные могут прийти не сразу как пришел адрес

4)  Арбитраж с перекрытием

Это когда обработка следующего арбитража происходит, когда мы удовлетворили текущий арбитраж( то есть сейчас происходит какой-то обмен данными, а выбор того, кто будет следующим происходит во время этой обработки данных)

5)  Арбитраж с удержанием шины

Суть в том, что если никто шину не трогает, то не надо снимать сигнал запроса с устройства( то есть я занял шину и общаюсь по ней и тайминг этого устройства выходит, вместо того, чтобы прекратить общение с шиной и еще раз разыграть арбитраж и это же устройство снова ее займет, может вместо этого и не стоило прекращать обмен данными и просто продлить время, если никто больше не просит шину)

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image023.jpg)  

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image026.gif)

Шины малого интерфейса – это все последовательные интерфейсы, а шины большого интерфейса – последовательные интерфейсы.

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image028.jpg)

![](file:///C:/Users/kravr/AppData/Local/Temp/msohtmlclip1/01/clip_image030.jpg)

Для того, чтобы передать информацию достаточно одной сигнальной линии.