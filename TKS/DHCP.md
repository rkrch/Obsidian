Связанные: [[IP]], [[Маршрутизатор (Роутер)]]

**Dynamic Host Configuration Protocol** - 

На DHCP сервере задается пул адресов, которые он раздает клиентам, а также сервер отдает клиентам маску подсети, шлюз по умолчанию и может сообщить DNS сервера.

Устройство шлёт широковещательный DHCPDISCOVER с адресом отправителя `0.0.0.0` 
Роутер с DHCP сервером, отвечает по известному [[MAC]] DHCPOFFER.
Устройство шлёт broadcast DHCPREQUEST с полученным [[IP]]. 
Роутер записывает сопоставление мака и [[IP]] и шлёт DHCPACK. 

+- раз в сутки подтверждается активность устройства и продлевается аренда адреса.
Всяким принтерам закрепляется ~навсегда.

![[Pasted image 20260119111814.png]]


Протокол DHCP:
- Позволяет назначать IP-адреса компьютерам в сети автоматически    
- Требует создания инфраструктуры (DHCP сервер)    
- IP-адреса компьютер могут меняться      

Клиент DHCP
- Компьютер, который получает  IP-адреса автоматически     

Сервер DHCP
- Компьютер, который обеспечивает назначения IP- адресов     
- Ведет таблицу выделенных  IP-адресов, чтобы избежать дублирования     



### **Назначение адресов в  DHCP**

Фиксированный (это если знать заранее все мак адреса)
- Выделение IP- адреса для каждого MAC- адреса    

Динамический 
- Выделение компьютеру любого  IP-адреса из пула адресов    

Пул адресов 
- Список( диапазон) IP-адресов, которые назначает DHCP сервер     
- DHCP сервер следит за уникальностью распределения адресов


## **DHCPv6 - версия протокола DHCP для работы с адресами IPv6.**

Этот протокол назначает как IPv6 адреса, так и другие параметры настройки сети, такие, как адрес DNS (доменное имя).

 DHCPv6 может назначать IPv6 адреса через relay (ретранслятор). DHCPv6 сервер также может обеспечить сервис DHCPv6 без состояния отслеживания (SLAAC), при котором клиенту могут быть назначены параметры конфигурации, такие как адрес DNS-сервера и доменное имя без назначения IPv6-адреса.

В протоколе DHCPv6 предусмотрены три объекта: клиент, relay (ретранслятор) и сервер. 

Протокол DHCPv6 основан на протоколе UDP. 

Клиент DHCPv6 отправляет сообщения запроса конфигурации DHCP-серверу или DHCP-relay на порт UDP 547, в ответ сервер или relay DHCPv6 отправляют сообщения на порт UDP 546. Клиент DHCPv6 отправляет сообщения solicit и request DHCP-серверу или relay на multicast-адрес.

![[Pasted image 20260119132249.png]]
процесс согласования DHCPv6

Когда DHCPv6 клиент пытается запросить IPv6 адрес и другую конфигурацию, сначала клиент должен найти DHCPv6-сервер, а только после этого запросить конфигурацию.

- В момент обнаружения сервера, DHCP клиент пытается найти DHCPv6 сервер, рассылая SOLICIT сообщения, содержащее собственный идентификатор DUID, на мультикаст-адрес FF02::1:2;    
-  Каждый DHCPv6-сервер, получивший SOLICIT, ответит клиенту сообщением ADVERTISE (предложение), которое содержит идентификатор DUID сервера и его приоритет;    
- Возможно, что клиент получить несколько сообщений ADVERTISE. В этом случае клиент должен выбрать один сервер и ответить ему сообщение REQUEST, чтобы запросить предложенный им адрес;    
- Выбранный DHCPv6-сервер подтверждает клиенту IPv6 адрес и другие параметры в сообщении REPLY.    

Вышеуказанные четыре этапа завершают процесс динамического назначения параметров. Однако, если DHCPv6 сервер и DHCPv6 клиент не находятся в одной сети, сервер не сможет получить multicast-пакеты от клиента и ответить ему. Для пересылки таких пакетов используется DHCPv6-relay, функции которого реализованы на коммутаторе. Когда DHCPv6-relay получает сообщение от DHCPv6 клиента, он инкапсулирует его в пакет Relay-forward и доставляет следующему DHCPv6-relay или серверу.

Для делегирования IPv6 префиксов DHCPv6 сервер настраивается на маршрутизаторе провайдера (PE), а DHCPv6-клиент настраивается на маршрутизаторе клиента (CPE). Маршрутизатор клиента шлет маршрутизатору провайдера запрос на выделение префикса адресов и получает предварительно настроенный префикс. Затем CPE маршрутизатор делит выделенный префикс на /64 подсети. Эти префиксы будут анонсированы сообщениями объявления маршрутизатора (RA) хостам.